<%-
  form_args = if (resume.type == Resume.to_s)
    {model: resume, url: resume_path}
  else
    {model: resume}
  end
-%>
<%= turbo_frame_tag resume do %>
  <%= form_with(**form_args) do |form| %>
    <%= render "layouts/shared/model_errors", model: resume %>
    <div class="space-y-6 py-6">
      <% if resume.type == Resume.to_s %>
        <div>
          <h1 class="font-bold text-2xl">Your information</h1>
          <p class="text-sm text-slate-400 mt-3">Used globally in every resume.</p>
        </div>
        <%= form.fields_for :user do |user_subform| %>
          <div class="grid grid-cols-2 gap-4">
            <div class="col-span-2 md:col-span-1">
              <%= image_tag avatar_image_url_for(current_user), class: "rounded-xl shadow-xl mx-auto" %>
            </div>
            <div class="col-span-2 md:col-span-1 space-y-6">
              <div class="flex flex-col">
                <%= user_subform.label :avatar_image, class: "w-full mb-1 font-bold" %>
                <%= user_subform.file_field :avatar_image, class: "w-full border border-gray-400 rounded" %>
              </div>
              <div class="flex flex-col">
                <%= user_subform.label :first_name, class: "w-full mb-1 font-bold" %>
                <%= user_subform.text_field :first_name, class: "w-full border border-gray-400 rounded" %>
              </div>
              <div class="flex flex-col">
                <%= user_subform.label :last_name, class: "w-full mb-1 font-bold" %>
                <%= user_subform.text_field :last_name, class: "w-full border border-gray-400 rounded" %>
              </div>
              <div class="flex flex-col border border-red-500 p-2 rounded bg-red-100">
                <%= user_subform.label :username, class: "w-full mb-1 font-bold" %>
                <%= user_subform.text_field :username, class: "w-full border border-red-500 border-gray-400 rounded" %>
                <p class="text-sm mt-2 text-red-500">[Danger Zone]: All previous resume will point to a 404 page.</p>
              </div>
              <hr class="md:hidden">
            </div>
          </div>
        <% end %>
      <% else %>
        <div>
          <h1 class="font-bold text-2xl">Company information</h1>
          <p class="text-sm text-slate-400 mt-3">Add customization and your resume will stand out.</p>
        </div>
        <div class="flex items-center">
          <%= image_tag resume.avatar_image.persisted? ? url_for(resume.avatar_image) : resume.recruter_image_url, class: "w-20 h-20 rounded-full border-2 border-slate-400 mr-6" %>
          <div class="">
            <%= form.label :avatar_image, class: "w-full mb-1 font-bold" %>
            <%= form.file_field :avatar_image, class: "w-full border border-gray-400 rounded" %>
            <%= form.hidden_field :recruter_image_url, value: resume.recruter_image_url %>
          </div>
        </div>
        <div class="flex flex-col">
          <%= form.label :company_name, class: "w-full mb-1 font-bold" %>
          <%= form.text_field :company_name, class: "w-full border border-gray-400 rounded" %>
        </div>
        <div class="flex flex-col">
          <%= form.label :recruter_full_name, class: "w-full mb-1 font-bold" %>
          <%= form.text_field :recruter_full_name, class: "w-full border border-gray-400 rounded" %>
        </div>
        <div class="flex flex-col">
          <%= form.label :recruter_email, class: "w-full mb-1 font-bold" %>
          <%= form.text_field :recruter_email, class: "w-full border border-gray-400 rounded" %>
        </div>
        <% unless resume.persisted? %>
          <div class="flex flex-col">
            <%= form.label :job_description, class: "mb-1 font-bold" %>
            <%= form.text_area :job_description, class: "border border-gray-400 rounded", rows: "5" %>
          </div>
        <% end %>
      <% end %>
      <% if resume.type == Resume.to_s %>
        <h1 class="font-bold text-2xl pt-3">Your original resume</h1>
      <% else %>
        <div>
          <h1 class="font-bold text-2xl pt-3">Replica resume information</h1>
          <p class="text-sm text-slate-400 mt-3">Content bellow is generated by AI.</p>
        </div>
      <% end %>
      <div class="flex flex-col">
        <%= form.label :title, class: "w-full mb-1 font-bold" %>
        <%= form.text_field :title, class: "w-full border border-gray-400 rounded" %>
      </div>
      <div class="flex flex-col">
        <%= form.label :location, class: "w-full mb-1 font-bold" %>
        <%= form.text_field :location, class: "w-full border border-gray-400 rounded" %>
      </div>
      <div class="flex flex-col">
        <%= form.label :developer_since, class: "w-full mb-1 font-bold" %>
        <%= form.date_field :developer_since, class: "w-full border border-gray-400 rounded" %>
      </div>
      <div class="flex flex-col">
        <%= form.label :meeting_url, class: "mb-1 font-bold" %>
        <%= form.text_field :meeting_url, class: "border border-gray-400 rounded" %>
        <p class="text-sm mt-2 text-slate-400">Will show a contact link with this URL.</p>
      </div>
      <div class="flex flex-col">
        <%= form.label :video_url, class: "mb-1 font-bold" %>
        <%= form.text_field :video_url, class: "border border-gray-400 rounded" %>
        <p class="text-sm mt-2 text-slate-400">The image will become clickable and will open this URL.</p>
      </div>
      <div class="flex flex-col">
        <%= form.label :about, class: "w-full mb-1 font-bold" %>
        <%= form.text_area :about, class: "w-full border border-gray-400 rounded", rows: "12" %>
      </div>
      <% if resume.persisted? %>
        <div>
          <%= form.label :experiences, class: "mb-1 font-bold" %>
          <%= form.fields_for :experiences do |experience_subform| %>
            <%= turbo_frame_tag experience_subform.object do %>
              <div class="flex flex-col space-y-4 p-3 my-3 border border-gray-400 rounded">
                <div class="flex flex-col">
                  <%= experience_subform.label :title %>
                  <%= experience_subform.text_field :title, class: "border border-gray-400 rounded" %>
                </div>
                <div class="flex flex-col">
                  <%= experience_subform.label :description %>
                  <%= experience_subform.text_area :description, class: "border border-gray-400 rounded", rows: "4" %>
                </div>
                <div class="flex flex-col">
                  <%= experience_subform.label :started_at %>
                  <%= experience_subform.date_field :started_at, class: "border border-gray-400 rounded" %>
                </div>
                <div class="flex flex-col">
                  <%= experience_subform.label :ended_at %>
                  <%= experience_subform.date_field :ended_at, class: "border border-gray-400 rounded" %>
                </div>
                <div class="flex flex-col">
                  <%= experience_subform.label :skills %>
                  <%= experience_subform.text_field :skills, class: "border border-gray-400 rounded" %>
                  <p class="text-sm mt-2 text-slate-400">Separate them with a comma, e.g: Ruby On Rails, Hotwire</p>
                </div>
                <%= link_to 'Delete', experience_path(id: experience_subform.object.id), class: "text-red-500 px-2 py-1 border-red-500 mt-3 ml-auto font-medium border-2 rounded", data: { turbo_method: :delete } %>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>
    <div class="flex flex-col md:flex-row justify-between">
      <%= form.submit class: "rounded py-2 px-4 bg-blue-600 text-white inline-block font-medium cursor-pointer", data: { turbo_frame: "_top" } %>
      <% if (resume.experiences == Resumes::Experience::MAX_EXPERIENCES) %>
        <%= link_to "Add experience", experiences_path(id: form.object.id), data: { turbo_method: :post }, class: "text-indigo-700 py-2 px-4 font-medium border-2 rounded border-indigo-700" %>
      <% elsif(resume.persisted?) %>
        <div class="text-gray-700 py-2 px-4 font-medium border-2 rounded border-gray-700 mt-3 md:mt-0">Only <%= Resumes::Experience::MAX_EXPERIENCES %> experiences are allowed</div>
      <% end %>
    </div>
  <% end %>
<% end %>
